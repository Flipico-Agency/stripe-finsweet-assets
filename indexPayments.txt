"use strict";(()=>{var ee=document.querySelector("#cart-button"),te=document.querySelector("#added-to-cart");window.dataLayer=window.dataLayer||[];async function P(){try{let n=await(await fetch("https://koszyk.deckline.pl/api/cart",{credentials:"include"})).json();if(!Array.isArray(n))throw new Error("Received data is not an array");return n}catch(e){return console.error("Failed to fetch cart items:",e),[]}}function x(e){console.log("Jestem w renderCheckoutItems!"),document.querySelectorAll(".order-item-list").forEach(t=>{if(t){let l=a=>a.toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2});t.innerHTML="",e.forEach(a=>{let o=a.imageUrl,r=document.createElement("div");r.className="w-commerce-commercecheckoutorderitem order-item",r.innerHTML=`
          <img src="${o}" alt="${a.name}" class="w-commerce-commercecartitemimage">
          <div class="w-commerce-commercecheckoutorderitemdescriptionwrapper">
            <div class="w-commerce-commerceboldtextblock">${a.name}</div>
            <div class="w-commerce-commercecheckoutorderitemquantitywrapper">
              <div>Ilo\u015B\u0107: </div>
              <div>${a.quantity}</div>
            </div>
          </div>
          <div>${l(a.price)} z\u0142</div>
        `,t.appendChild(r)})}})}async function N(){try{return(await(await fetch("https://koszyk.deckline.pl/api/session-id",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json()).sessionID}catch(e){return console.error("B\u0142\u0105d podczas pobierania ID sesji:",e),null}}var _=async(e,n,t,l,a,o,r)=>{try{return await(await fetch("https://koszyk.deckline.pl/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({total_amount:Math.round(e*100),currency:"PLN",shipping_cost:Math.round(t*100),tax_cost:Math.round(a*100),customer_email:o.email,customer_name:o.name,shipping_address:{address_line1:o.address,address_line2:o.parcelMachine,city:o.city,postal_code:o.zip,country:o.country},nip:o.nip,phone:o.phone,additional_info:o.additionalInfo,shipping_choice:l,company_name:o.companyName,company_address:o.companyAddress,company_zip:o.companyZIP,company_city:o.companyCity,sessionID:r})})).json()}catch(i){return console.error("Error creating payment intent:",i),null}};var A=(e,n,t,l,a,o)=>{let r=f=>f.toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2}),i=document.querySelector(".products-cost");i&&(i.textContent=`${r(e)} z\u0142`);let s=document.querySelector(".tax");s&&(s.textContent=`${r(n)} z\u0142`);let c=document.querySelector(".shipment-method-choice");c&&(c.textContent=`${t}`);let u=document.querySelector(".shipment-method-value");u&&(u.textContent=`${r(l)} z\u0142`);let m=document.querySelector(".coupon-amount");m&&(m.textContent=`${r(o)} z\u0142`);let d=document.querySelector(".total-cost");d&&(d.textContent=`${r(a)} z\u0142`)};var J=async e=>{try{return await(await fetch("https://koszyk.deckline.pl/api/validate-coupon",{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({couponCode:e})})).json()}catch(n){return console.error("Error checking coupon:",n),{isValid:!1,discountType:null,amount:0}}};function D(e,n){let t=a=>a.toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2}),l=document.getElementById("apply-coupon");if(!l){console.error("Nie znaleziono przycisku kuponu.");return}l.addEventListener("click",async()=>{console.log("Klikni\u0119to przycisk kuponu!");let a=document.getElementById("coupon-code"),o=document.getElementById("coupon-feedback");if(!a||!o){console.error("Nie znaleziono elementu formularza kuponu.");return}let r=a.value.trim(),{isValid:i,discountType:s,amount:c}=await J(r);if(!i){o.textContent="Nieprawid\u0142owy kupon.",o.style.display="block",o.classList.remove("hide");return}let u=e.reduce((f,p)=>f+p.price*p.quantity,0),m=s==="percentage"?u*(c/100):c/100,d=s==="fixed"?`Zni\u017Cka: ${t(c/100)} z\u0142`:`Zni\u017Cka: ${t(c)}%`;o.textContent=`Kupon zosta\u0142 dodany. ${d}`,o.style.display="block",o.classList.remove("hide"),console.log(`Zastosowany rabat: ${m} z\u0142`),n(m)})}var j=async e=>{try{let n=()=>{let r="0123456789ABCDEF",i="#";for(let s=0;s<6;s++)i+=r[Math.floor(Math.random()*16)];return i},t=e.map(r=>{let[i,s,c]=r.dimensions.split("x").map(Number);return{name:r.name,type:"item",width:s,height:i,depth:c,weight:r.realWeight,quantity:r.quantity,color:n()}}),a=await(await fetch("https://deckline-3d-bin-packer.onrender.com/runPacking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t})})).json();if(!a.success)throw new Error("Packing calculation failed");let o=a.iteration_count;return console.log(`Total InPost packages required: ${o}`),{totalPackages:o}}catch(n){return console.error("Error:",n),{totalPackages:1}}};var F=()=>{let e=document.querySelector("#Email")?.value||"",n=document.querySelector("#wf-ecom-shipping-name")?.value||"",t=document.querySelector("#wf-ecom-shipping-address")?.value||"",l=document.querySelector("#wf-ecom-shipping-city")?.value||"",a=document.querySelector("#wf-ecom-shipping-zip")?.value||"",o=document.querySelector("#wf-ecom-shipping-country")?.value||"Poland",r=document.querySelector("#nip")?.value||"",i=document.querySelector("#Telefon")?.value||"",s=document.querySelector("#DodatkoweInformacje")?.value||"",c=document.querySelector("#parcel-field")?.value||"",u=document.querySelector("#nazwa-firmy")?.value||"",m=document.querySelector("#Ulica")?.value||"",d=document.querySelector("#Kod-pocztowy")?.value||"",f=document.querySelector("#Miasto")?.value||"";return{email:e,name:n,address:t,city:l,zip:a,country:o,nip:r,phone:i,additionalInfo:s,parcelMachine:c,companyName:u,companyAddress:m,companyZIP:d,companyCity:f}},b=()=>{try{let e=window.Stripe("pk_live_51PhtmC2KbH6CAnJTel0InhWqePpuPFhq7HYcXRuv8cYvs5FdFEnLXc6nm2QsS8lMPUlSBcIQsT7eur2dy53XeZNK00VnL9Bvxc",{stripeAccount:"acct_1PhtmC2KbH6CAnJT"});if(!e){console.error("Inicjalizacja Stripe zwr\xF3ci\u0142a warto\u015B\u0107 undefined.");return}return e}catch(e){console.error("B\u0142\u0105d podczas tworzenia instancji Stripe:",e);return}},$=async()=>{if(!b())return console.error("Stripe could not be initialized."),!1;let n=document.querySelector('[data-element="payment_form"]');return n?(n.addEventListener("keydown",t=>{t.key==="Enter"&&t.preventDefault()}),n):(console.error("Payment form not found."),!1)};async function V(e){let n=c=>c.toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2}),l=e.every(c=>c.name.toLowerCase().includes("podk\u0142adki")),a=e.every(c=>c.name.toLowerCase().includes("pr\xF3bka")),o=e.reduce((c,u)=>c+u.price*u.quantity,0),r={kurier:document.querySelector("#cost-kurier"),inpost:document.querySelector("#cost-inpost")},i=13.99,s=13.99;if(l&&o>=100)i=0,s=0;else if(a)i=5,s=5;else{let{totalPackages:c}=await j(e);c>1&&(s+=(c-1)*s)}r.kurier&&(r.kurier.textContent=`${n(i)} z\u0142`),r.inpost&&(r.inpost.textContent=`${n(s)} z\u0142`)}var O=e=>{let n=document.querySelector('a[data-form="next-btn"]'),t=document.querySelector('input[data-form="submit-btn-normal"]'),l=document.querySelector('div[data-step="1"]'),a=document.querySelector('div[data-step="2"]'),o=document.querySelector("#is-items"),r=document.querySelectorAll('input[name="Dostawa"]'),i=Array.from(r).find(p=>p.value==="Dostawa Spedycyjna"),s=document.querySelector("#nip"),c=document.querySelector("#Company"),u=document.querySelector("#nazwa-firmy"),m=document.querySelector("#Ulica"),d=document.querySelector("#Kod-pocztowy"),f=document.querySelector("#Miasto");return s?.removeAttribute("required"),c?.addEventListener("change",()=>{c.checked?(s?.setAttribute("required","true"),u?.setAttribute("required","true"),m?.setAttribute("required","true"),d?.setAttribute("required","true"),f?.setAttribute("required","true")):(s?.removeAttribute("required"),u?.removeAttribute("required"),m?.removeAttribute("required"),d?.removeAttribute("required"),f?.removeAttribute("required"))}),r.forEach(p=>{e.some(q=>q.length>60)?(p.value==="66b3793346ac0078df04ddcc"||p.value==="66b3793346ac0078df04ddce"||p.value==="Kurier")&&p.closest(".shipping-method")?.remove():(console.log("Usuwam dostaw\u0119 paletow\u0105, poniewa\u017C \u017Caden przedmiot nie przekracza 60 cm."),i?.closest(".shipping-method")?.remove()),V(e)}),console.log("Zako\u0144czono setupUIElements."),{nextButton:n,payButton:t,stepOneWrapper:l,stepTwoWrapper:a,isItemsInput:o,shippingMethodInputs:r,palletDelivery:i,companyCheckbox:c,nipInput:s,companyNameInput:u,companyAddressInput:m,companyZIPInput:d,companyCityInput:f}};var B=async(e,n)=>{e&&n?(e.style.display="none",n.style.display="flex",window.scrollTo({top:0,behavior:"smooth"})):console.error("One of the step wrappers is not found.")},R=async(e,n,t)=>{e?(n.disabled=!1,n.style.cursor="pointer",n.style.opacity="1",t.value="true"):(n.disabled=!0,n.style.cursor="not-allowed",n.style.opacity="0.5",t.value="",alert("Tw\xF3j koszyk jest pusty. Dodaj przedmioty do koszyka przed przej\u015Bciem do nast\u0119pnego kroku."),window.location.href="/sklep")};var G=(e,n,t,l)=>{let a=Array.from(e).every(i=>i.value.trim()!==""),o=l.value==="true";a&&o?(t.disabled=!1,t.style.cursor="pointer",t.style.opacity="1",t.style.pointerEvents="auto"):(t.disabled=!0,t.style.cursor="not-allowed",t.style.opacity="0.5",t.style.pointerEvents="none"),t.style.display="flex"},W=(e,n,t)=>{let l=n.querySelectorAll("input[required], select[required]"),a=()=>G(l,n,e,t);l.forEach(o=>{o.addEventListener("input",a)}),t.addEventListener("input",a),a()},K=e=>/^\d{10}$/.test(e),U=(e,n,t,l,a,o,r,i)=>{if(l<=2)return alert("Suma produkt\xF3w w koszyku musi wynosi\u0107 wi\u0119cej ni\u017C 2.00 z\u0142, aby kontynuowa\u0107."),!1;let s=document.querySelector("#parcel-field")?.value.trim()||"";if((e.includes("PACZKOMAT INPOST")||e.includes("AUTOMAT DHL"))&&!(s!==""))return alert("Zaznaczy\u0142e\u015B opcj\u0119 paczkomat\xF3w, lecz nie wybra\u0142e\u015B \u017Cadnego punktu."),!1;let m=n?.checked??!1,d=t?.value.trim()!=="",f=t?.value?K(t.value.trim()):!0;if(m&&(!d||!f))return alert(d?"Podany NIP jest niepoprawny.":"Zaznaczy\u0142e\u015B opcj\u0119 zakupu jako firma, lecz nie uzupe\u0142ni\u0142e\u015B NIP."),!1;if(m){if(!a?.value.trim())return alert("Zaznaczy\u0142e\u015B opcj\u0119 zakupu jako firma, lecz nie uzupe\u0142ni\u0142e\u015B nazwy firmy."),!1;if(!o?.value.trim())return alert("Zaznaczy\u0142e\u015B opcj\u0119 zakupu jako firma, lecz nie uzupe\u0142ni\u0142e\u015B adresu firmy."),!1;if(!r?.value.trim())return alert("Zaznaczy\u0142e\u015B opcj\u0119 zakupu jako firma, lecz nie uzupe\u0142ni\u0142e\u015B kodu pocztowego firmy."),!1;if(!i?.value.trim())return alert("Zaznaczy\u0142e\u015B opcj\u0119 zakupu jako firma, lecz nie uzupe\u0142ni\u0142e\u015B miasta firmy."),!1}return!0};window.dataLayer=window.dataLayer||[];var Q=async e=>{let n=await $();if(!n)return;let t=await P();if(t.length===0){alert("Tw\xF3j koszyk jest pusty."),window.location.href="/sklep";return}let{nextButton:l,payButton:a,stepOneWrapper:o,stepTwoWrapper:r,isItemsInput:i,companyCheckbox:s,nipInput:c,companyNameInput:u,companyAddressInput:m,companyZIPInput:d,companyCityInput:f}=O(t);if(!o||!r||!i||!a||!l)return;await R(t,a,i),W(l,o,i);let p=0;D(t,L=>{p=L,console.log("Zaktualizowany rabat:",p)}),x(t),l?.addEventListener("click",async()=>{let L=F(),M=document.querySelector('input[name="Dostawa"]:checked'),h=M?.nextElementSibling?.textContent||"Brak wyboru",v=parseFloat(M?.nextElementSibling?.nextElementSibling?.textContent?.replace(" Z\u0141","").trim().replace(",",".")||"0");console.log(h,v);let I=t.reduce((y,w)=>y+w.price*w.quantity,0),C=I*.23,g=I+Number(v)-p;if(!U(h,s,c,g,u,m,d,f))return;A(I,C,h,v,g,p),await B(o,r);let Z=await N(),S=await _(g,t,v,h,C,L,Z);if(!S){console.error("Payment intent is missing.");return}window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"begin_checkout",ecommerce:{currency:"PLN",value:g,items:t.map(y=>({item_id:y.id,item_name:y.name,affiliation:"Google Merchandise Store",price:y.price,quantity:y.quantity}))}}),window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"add_shipping_info",ecommerce:{currency:"PLN",value:g,shipping_tier:h,items:t.map(y=>({item_id:y.id,item_name:y.name,affiliation:"Google Merchandise Store",price:y.price,quantity:y.quantity}))}});let z=document.querySelector('[data-element="stripe"]');if(!z){console.error("Stripe element could not be found. Ensure that the element has the correct data-element attribute.");return}let T=e.elements({clientSecret:S.client_secret});T.create("payment").mount(z),n.addEventListener("submit",async y=>{y.preventDefault(),y.stopPropagation(),await T.submit();let w=await e.confirmPayment({elements:T,clientSecret:S.client_secret,redirect:"always",confirmParams:{return_url:"https://www.deckline.pl/potwierdzenie-zamowienia"}}),k=document.querySelector(".w-form-done"),E=document.querySelector(".w-form-fail"),H=document.querySelector(".container-medium");w.error?(E&&(E.textContent=`P\u0142atno\u015B\u0107 nieudana: ${w.error.message}`,E.style.display="block"),k&&(k.style.display="none")):(k&&(k.textContent="P\u0142atno\u015B\u0107 zako\u0144czona sukcesem!",k.style.display="block"),E&&(E.style.display="none"),H&&(H.style.display="none"))},!0)})};document.addEventListener("DOMContentLoaded",async()=>{let e=b();if(e){if(window.isWebflowInitialized)return;window.isWebflowInitialized=!0,await Q(e)}else console.error("Stripe could not be initialized.")});})();
