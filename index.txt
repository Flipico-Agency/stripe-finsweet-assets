"use strict";(()=>{var E=document.querySelector("#cart-button"),y=document.querySelector("#added-to-cart");window.dataLayer=window.dataLayer||[];async function f(){try{let r=await(await fetch("https://koszyk.deckline.pl/api/cart",{credentials:"include"})).json();if(!Array.isArray(r))throw new Error("Received data is not an array");return r}catch(e){return console.error("Failed to fetch cart items:",e),[]}}async function g(){try{let e=a=>a.toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2}),r=document.querySelector(".state-default"),t=document.querySelector(".state-empty"),o=await f(),n=o.reduce((a,i)=>a+i.price*i.quantity,0),s=document.querySelector('[data-output="cart-total"]'),c=document.querySelectorAll('[data-output="remaining-to-free-shipping-wrapper"]'),m=document.querySelectorAll('[data-output="free-shipping-wrapper"]'),h=document.querySelectorAll('[data-output="remaining-to-free-shipping"]'),l=document.getElementById("cart-quantity");if(s&&(s.textContent=`${e(n)} z\u0142`),l&&(l.textContent=o.reduce((a,i)=>a+i.quantity,0).toString()),window.location.pathname==="/koszyk"&&(E&&E.remove(),window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"view_cart",ecommerce:{currency:"PLN",value:n,items:o.map(a=>({item_id:a.id,item_name:a.name,affiliation:"Google Merchandise Store",price:a.price,quantity:a.quantity}))}})),o.length>0&&o.every(a=>a.name.toLowerCase().includes("podk\u0142adki"))){let a=100-n;a>0?(c.forEach(i=>i.classList.remove("hide")),h.forEach(i=>i.textContent=`${e(a)} z\u0142`),m.forEach(i=>i.classList.add("hide"))):(c.forEach(i=>i.classList.add("hide")),m.forEach(i=>i.classList.remove("hide")))}else c.forEach(a=>a.classList.add("hide")),m.forEach(a=>a.classList.add("hide"));r&&t&&(o.length>0?(r.style.display="block",t.style.display="none"):(r.style.display="none",t.style.display="flex")),P(o),document.querySelectorAll(".sample-wrapper").forEach(a=>{let i=a.querySelector(".text-weight-bold")?.textContent?.trim();if(!i)return;o.some(w=>w.name.trim()===i.trim())?I(a):L(a)})}catch(e){console.error("Failed to update cart UI:",e)}}function q(){document.querySelectorAll(".sample-wrapper").forEach(r=>{r.addEventListener("click",async()=>{let t=r.querySelector('form[data-node-type="commerce-add-to-cart-form"]');if(!t)return;let o=t.getAttribute("data-commerce-sku-id"),n=t.getAttribute("data-commerce-product-id"),s=r.querySelector(".text-weight-bold")?.textContent?.trim()||"";if(!o||!n||!s){console.error("Brak danych produktu w pr\xF3bce.");return}try{let m=(await f()).find(h=>h.name.trim()===s);if(m)await T(m.id),L(r);else{I(r);let l=await(await fetch("https://hook.eu2.make.com/kr1cnajv95yw1vhqtchs7u5zvixffyuv",{method:"POST",body:JSON.stringify({productId:n,quantity:1,skuId:o})})).json(),d=l[0].fieldData,u={id:l[0].id,name:d.name,price:d.price.value/100,quantity:l[0].quantity,imageUrl:d["main-image"]?.url,weight:d.weight,length:d.length,sku:d.sku,slug:d.slug,dimensions:l[0].wymiary,realWeight:l[0].waga?Number(l[0].waga.replace(",",".")):0};await S(u,{skipModal:!0})}}catch(c){console.error("B\u0142\u0105d przy klikni\u0119ciu pr\xF3bki:",c)}})})}function I(e){e.style.backgroundColor="green"}function L(e){e.style.backgroundColor="var(--background-color--background-product)"}function C(){document.addEventListener("click",async e=>{let r=e.target;if(!r.classList.contains("w-commerce-commerceaddtocartbutton"))return;e.preventDefault();let t=r.closest(".additional-product-item")||r.closest(".product-header2_add-to-cart")||r.closest(".product2_item");if(!t){console.error("Product element not found");return}let o=t.querySelector("form")?.getAttribute("data-commerce-product-id")||"",n=t.querySelector('form select[data-node-type="commerce-add-to-cart-option-select"]');if(n&&n.value===""){alert("Prosz\u0119 wybra\u0107 opcj\u0119 przed dodaniem produktu do koszyka.");return}let s=null,c=t.querySelector('form div[data-node-type="commerce-add-to-cart-pill-group"]');c&&(s=c.querySelector('form div[aria-checked="true"]'));let m=t.querySelector('input[name="commerce-add-to-cart-quantity-input"]'),h=m?parseInt(m.value):1,l=n?n.value:s?.getAttribute("data-option-id")??null;l||(l=t.querySelector("form")?.getAttribute("data-commerce-sku-id")||"");try{let u=await(await fetch("https://hook.eu2.make.com/kr1cnajv95yw1vhqtchs7u5zvixffyuv",{method:"POST",body:JSON.stringify({productId:o,quantity:h,skuId:l})})).json(),p=u[0].fieldData,a={id:u[0].id,name:p.name,price:p.price.value/100,quantity:u[0].quantity,imageUrl:p["main-image"]?.url,weight:p.weight,length:p.length,sku:p.sku,slug:p.slug,dimensions:u[0].wymiary,realWeight:u[0].waga?Number(u[0].waga.replace(",",".")):0},i=a.name;if(i.startsWith("Pr\xF3bka")){let v=await f(),w=i.replace("Pr\xF3bka ","").trim();if(v.find(b=>b.name.startsWith("Pr\xF3bka")&&b.name.includes(w))){alert("Masz ju\u017C jedn\u0105 tak\u0105 pr\xF3bk\u0119 w koszyku.");return}}await S(a,{skipModal:!1})}catch(d){console.error("Error getting selected item:",d)}})}async function S(e,r){try{let t=await fetch("https://koszyk.deckline.pl/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!t.ok)throw new Error(`Failed to add item to cart: ${t.statusText}`);window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:"PLN",value:e.price*e.quantity,items:[{item_id:e.id,item_name:e.name,affiliation:"Google Merchandise Store",price:e.price,quantity:e.quantity}]}}),await g(),y&&!r.skipModal&&(y.style.display="flex",y.style.opacity="0",y.style.transition="opacity 0.5s ease",setTimeout(()=>{y.style.opacity="1"},10),setTimeout(()=>{y.style.opacity="0",setTimeout(()=>{y.style.display="none"},500)},1500))}catch(t){console.error("Failed to add item to cart:",t)}}async function T(e){try{let t=(await f()).find(o=>o.id===e);await fetch(`https://koszyk.deckline.pl/api/cart/${e}`,{method:"DELETE",credentials:"include"}),t&&(window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"remove_from_cart",ecommerce:{currency:"PLN",value:t.price*t.quantity,items:[{item_id:t.id,item_name:t.name,affiliation:"Google Merchandise Store",price:t.price,quantity:t.quantity}]}})),await g()}catch(r){console.error("Failed to remove item from cart:",r)}}async function M(e,r){try{await fetch(`https://koszyk.deckline.pl/api/cart/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:r}),credentials:"include"}),await g()}catch(t){console.error("Failed to update item quantity:",t)}}function x(){document.addEventListener("change",async e=>{let r=e.target;if(!r.classList.contains("is-quantity-input"))return;let t=parseInt(r.value,10),o=r.closest(".cart-item")?.querySelector(".remove-from-cart")?.getAttribute("data-item-id");o&&t>0&&await M(o,t)})}function P(e){let r=document.querySelector(".cart-list");if(!r)return;let t=n=>n.toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2});r.innerHTML="",e.forEach(n=>{let s=n.name.startsWith("Pr\xF3bka"),c=document.createElement("div");c.className="cart-item",c.innerHTML=`
      <img src="${n.imageUrl}" loading="lazy" alt="${n.name}" class="image-2">
      <a href="/product/${n.slug}" class="product-link">
        <div>
          <div class="text-weight-bold text-style-2lines">${n.name}</div>
          <div class="div-block">
            <div class="text-color-brand">Cena: ${t(n.price)} z\u0142</div>
            <div class="text-color-brand">Ilo\u015B\u0107: ${n.quantity}</div>
          </div>
        </div>
      </a>
      <div class="w-form">
        <input 
          class="form_input is-quantity-input w-input"
          maxlength="256"
          value="${s?1:n.quantity}"
          type="number"
          min="1"
          ${s?"disabled":""}
        />
      </div>
      <div class="icon-embed-xsmall w-embed remove-from-cart" data-item-id="${n.id}">
        <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" width="100%" height="100%" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 6L6 18M6 6l12 12"></path>
        </svg>
      </div>
    `,r.appendChild(c)}),x(),document.querySelectorAll(".remove-from-cart").forEach(n=>{n.addEventListener("click",async s=>{let c=s.currentTarget.getAttribute("data-item-id");c&&await T(c)})})}async function k(){await g(),C(),q()}var _=async()=>{window.Webflow||(window.Webflow=[]),window.Webflow.push(async()=>{if(!window.isWebflowInitialized){window.isWebflowInitialized=!0;try{let e=new URLSearchParams(window.location.search),r=e.get("redirect_status")??"",t=e.get("payment_intent")??"",o=localStorage.getItem("payment_intent")??"";r==="succeeded"?t!==o?(localStorage.setItem("payment_intent",t),setTimeout(()=>{window.location.reload()},2e3)):await k():await k()}catch(e){console.error("B\u0142\u0105d podczas obs\u0142ugi Webflow:",e)}}})};_();})();
